{% extends 'dashboard_base.html' %}
{% load static %}
{% block title %} SISIMPUR - AI-Powered Exam Prep {% endblock %}
{% block content %}


    <!-- Page Content -->
    <div class="content-wrapper">
      <div class="content-container">
        <div class="quiz-section">
          <h1 class="page-title">Create Quiz</h1>
          <p class="page-description">Generate AI-powered quizzes from your content</p>

          <div class="quiz-form">
            <form id="document-upload-form" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="form-group">
                <label>Upload Document for Question Generation</label>
                <p class="upload-description">Upload a document and our AI will extract text using OCR and generate questions automatically</p>

                <div class="file-upload">
                  <input type="file" id="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png" required hidden />
                  <label for="file-input" class="file-upload-btn">
                    <i class="ri-upload-cloud-line"></i>
                    Upload Document
                  </label>
                  <span class="file-types">Supported: PDF, JPG, PNG (OCR + Question Generation)</span>
                  <div id="file-preview" class="file-preview" style="display: none;"></div>
                </div>
              </div>

              <div class="quiz-options">
                <div class="option-group">
                  <label>Number of Questions</label>
                  <select class="quiz-select" id="question-count" name="num_questions">
                    <option value="">Auto (Optimal)</option>
                    <option value="3">3 Questions</option>
                    <option value="5">5 Questions</option>
                    <option value="8">8 Questions</option>
                    <option value="10" selected>10 Questions</option>
                    <option value="15">15 Questions</option>
                    <option value="20">20 Questions</option>
                  </select>
                </div>

                <div class="option-group">
                  <label>Question Type</label>
                  <select class="quiz-select" id="question-type" name="question_type">
                    <option value="MULTIPLECHOICE" selected>Multiple Choice</option>
                    <option value="SHORT">Short Answer</option>
                  </select>
                </div>

                <div class="option-group">
                  <label>Language Detection</label>
                  <select class="quiz-select" id="language" name="language">
                    <option value="auto" selected>Auto Detect</option>
                    <option value="english">English</option>
                    <option value="bengali">Bengali</option>
                  </select>
                </div>
              </div>

              <button type="submit" class="generate-btn" id="generate-btn">
                <i class="ri-magic-line"></i>
                <span id="btn-text">Generate Quiz</span>
                <div id="loading-spinner" style="display: none;">
                  <i class="ri-loader-4-line"></i> Processing...
                </div>
              </button>
            </form>

            <!-- Processing Status -->
            <div id="processing-status" style="display: none;" class="processing-status">
              <div class="status-content">
                <div class="status-icon">
                  <i class="ri-loader-4-line"></i>
                </div>
                <h3>Processing Document...</h3>
                <p id="status-message">Extracting text and generating questions...</p>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-fill"></div>
                </div>
              </div>
            </div>

            <!-- Recent Jobs -->
            {% if recent_jobs %}
            <div class="recent-jobs">
              <h3>Recent Quizzes</h3>
              <div class="jobs-list">
                {% for job in recent_jobs %}
                <div class="job-item">
                  <div class="job-info">
                    <h4>{{ job.document_name }}</h4>
                    <p class="job-status status-{{ job.status }}">{{ job.get_status_display }}</p>
                    <small>{{ job.created_at|date:"M d, Y H:i" }}</small>
                  </div>
                  <div class="job-actions">
                    {% if job.status == 'completed' %}
                      <a href="{% url 'dashboard:quiz_results' job.id %}" class="btn-small">View Results</a>
                    {% elif job.status == 'failed' %}
                      <span class="error-text">Failed</span>
                    {% else %}
                      <span class="processing-text">Processing...</span>
                    {% endif %}
                  </div>
                </div>
                {% endfor %}
              </div>
              <a href="{% url 'dashboard:my_quizzes' %}" class="view-all-link">View All Quizzes â†’</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    </main>
{% endblock %}