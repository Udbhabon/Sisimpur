{% extends 'dashboard_base.html' %}
{% load static %}
{% block title %}Exam - {{ exam_session.processing_job.document_name }} - SISIMPUR{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/exam_session.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="content-container">
        <div class="exam-container">
            <!-- Exam Header -->
            <div class="exam-header">
                <h1 class="exam-title">{{ exam_session.processing_job.document_name }}</h1>
                <div class="exam-timer" data-remaining-time="{{ remaining_time }}">
                    <i class="ri-timer-line"></i>
                    <span id="timer-display">{{ remaining_time|floatformat:0 }}s</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="exam-progress">
                <span class="progress-info">Question {{ current_index|add:1 }} of {{ total_questions }}</span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ progress_percentage }}%"></div>
                </div>
                <span class="progress-info">{{ progress_percentage }}% Complete</span>
            </div>

            <!-- Question Container -->
            <div class="question-container">
                <div class="question-header">
                    <span class="question-number">Question {{ current_index|add:1 }}</span>
                    <span class="question-type">{{ current_question.get_question_type_display }}</span>
                </div>

                <div class="question-text">
                    {{ current_question.question }}
                </div>

                <form method="post" id="exam-form">
                    {% csrf_token %}
                    <div class="answer-section">
                        {% if current_question.question_type == 'MULTIPLECHOICE' %}
                            <div class="answer-options">
                                {% for option in current_question.get_formatted_options %}
                                    <div class="answer-option" onclick="selectOption(this)">
                                        <input type="radio" name="answer" value="{{ option.key }}" id="option_{{ forloop.counter }}"
                                               {% if existing_answer and existing_answer.user_answer == option.key %}checked{% endif %}>
                                        <label for="option_{{ forloop.counter }}">{{ option.key }}) {{ option.text }}</label>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <textarea name="answer" class="text-answer" placeholder="Enter your answer here..."
                                      required>{% if existing_answer %}{{ existing_answer.user_answer }}{% endif %}</textarea>
                        {% endif %}
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="navigation-buttons">
                        <button type="submit" name="action" value="previous" class="nav-btn btn-previous"
                                {% if not can_go_back %}disabled{% endif %}>
                            <i class="ri-arrow-left-line"></i>
                            Previous
                        </button>

                        <div style="flex: 1;"></div>

                        {% if is_last_question %}
                            <button type="submit" name="action" value="submit" class="nav-btn btn-submit">
                                <i class="ri-check-line"></i>
                                Submit Exam
                            </button>
                        {% else %}
                            <button type="submit" name="action" value="next" class="nav-btn btn-next">
                                Next
                                <i class="ri-arrow-right-line"></i>
                            </button>
                        {% endif %}
                    </div>
                </form>
            </div>

            <!-- Warning for time -->
            {% if remaining_time < 300 %}
            <div class="warning-message">
                <i class="ri-alarm-warning-line"></i>
                <span>Warning: Less than 5 minutes remaining!</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/exam_session.js' %}"></script>
{% endblock %}
