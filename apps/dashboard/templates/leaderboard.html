{% extends 'dashboard_base.html' %}
{% load static %}
{% block title %}Global Leaderboard - SISIMPUR{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="content-container">
        <div class="leaderboard-container">
            <!-- Consistent Header Design -->
            <div class="page-header">
                <h1 class="page-title">üèÜ Global Leaderboard</h1>
            </div>
            <p class="page-description">Compete with learners worldwide and climb to the top!</p>
            
            <!-- Stats Overview -->
            <div class="stats-overview">
                <div class="stat-card total">
                    <div class="stat-value">{{ total_users|default:0 }}</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card active">
                    <div class="stat-value">{{ active_users_week|default:0 }}</div>
                    <div class="stat-label">Active This Week</div>
                </div>
                <div class="stat-card exams">
                    <div class="stat-value">{{ total_exams_completed|default:0 }}</div>
                    <div class="stat-label">Exams Completed</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-section">
                <a href="?filter=all" class="filter-btn {% if filter_type == 'all' %}active{% endif %}">All Time</a>
                <a href="?filter=week" class="filter-btn {% if filter_type == 'week' %}active{% endif %}">This Week</a>
                <a href="?filter=month" class="filter-btn {% if filter_type == 'month' %}active{% endif %}">This Month</a>
                <a href="?filter=year" class="filter-btn {% if filter_type == 'year' %}active{% endif %}">This Year</a>
            </div>

            <!-- Leaderboard Table -->
            <div class="leaderboard-table">
                <div class="table-header">
                    <div>Rank</div>
                    <div>User</div>
                    <div>Score</div>
                    <div class="desktop-only">Exams</div>
                    <div class="desktop-only">Avg Score</div>
                    <div>Badge</div>
                </div>

                <div class="leaderboard-list">
                    {% if leaderboard_data %}
                        {% for item in leaderboard_data %}
                            <div class="leaderboard-item {% if item.is_current_user %}current-user{% endif %}">
                                <div class="rank {% if item.rank == 1 %}top-1{% elif item.rank == 2 %}top-2{% elif item.rank == 3 %}top-3{% endif %}">
                                    {% if item.rank == 1 %}
                                        <i class="ri-trophy-fill crown-icon"></i>
                                    {% elif item.rank == 2 %}
                                        <i class="ri-medal-fill crown-icon"></i>
                                    {% elif item.rank == 3 %}
                                        <i class="ri-award-fill crown-icon"></i>
                                    {% endif %}
                                    {{ item.rank }}
                                </div>
                                <div class="user-info">
                                    {% if item.user.profile.avatar %}
                                        <img src="{{ item.user.profile.avatar.url }}" alt="{{ item.user.get_full_name|default:item.user.username }}" class="user-avatar">
                                    {% else %}
                                        <img src="{% static 'images/default-avatar.png' %}" alt="{{ item.user.get_full_name|default:item.user.username }}" class="user-avatar">
                                    {% endif %}
                                    <div class="user-details">
                                        <h4>{{ item.user.get_full_name|default:item.user.username }}{% if item.is_current_user %} (You){% endif %}</h4>
                                        <p>{{ item.title }}</p>
                                    </div>
                                </div>
                                <div class="score-value">{{ item.total_score }}</div>
                                <div class="exams-count">{{ item.total_exams }}</div>
                                <div class="avg-score">{{ item.avg_percentage }}%</div>
                                <div class="leaderboard-badge {{ item.badge }}">{{ item.badge_label }}</div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="ri-trophy-line"></i>
                            <h3>No Rankings Yet</h3>
                            <p>Be the first to take an exam and claim the top spot!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/leaderboard.js' %}"></script>
{% endblock %}
