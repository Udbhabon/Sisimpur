{% extends 'dashboard_base.html' %}
{% load static %}
{% block title %} Quiz Generator - SISIMPUR {% endblock %}

{% block extra_head %}
<!-- Dropzone CSS -->
<link href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="{% static 'css/quiz_generator.css' %}">
{% endblock %}

{% block content %}

<div class="content-wrapper">
  <div class="content-container">
    <div class="quiz-section">
      <h1 class="page-title">Document Quiz Generator</h1>
      <p class="page-description">Upload documents and generate AI-powered quizzes with OCR text extraction</p>

      <!-- Hidden CSRF Token for JS -->
      {% csrf_token %}

      <div class="quiz-form">
        <!-- Quiz Options -->
        <div class="quiz-options-form">
          <h3>Quiz Configuration</h3>

          <div class="quiz-options">
            <div class="option-group">
              <label for="question-count">Number of Questions</label>
              <select class="quiz-select" id="question-count" name="num_questions">
                <option value="">Auto (Optimal)</option>
                <option value="3">3 Questions</option>
                <option value="5">5 Questions</option>
                <option value="8">8 Questions</option>
                <option value="10" selected>10 Questions</option>
                <option value="15">15 Questions</option>
                <option value="20">20 Questions</option>
              </select>
            </div>

            <div class="option-group">
              <label for="question-type">Question Type</label>
              <select class="quiz-select" id="question-type" name="question_type">
                <option value="MULTIPLECHOICE" selected>Multiple Choice</option>
                <option value="SHORT">Short Answer</option>
              </select>
            </div>

            <div class="option-group">
              <label for="language">Language Detection</label>
              <select class="quiz-select" id="language" name="language">
                <option value="auto" selected>Auto Detect</option>
                <option value="english">English</option>
                <option value="bengali">Bengali</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Dropzone Upload -->
        <div class="upload-section">
          <h3>Upload Document</h3>
          <p class="upload-description">Upload a document first, then click Generate to process it</p>

          <div class="dropzone" id="document-dropzone" data-upload-url="{% url 'dashboard:api_process_document' %}">
            <div class="dz-message" data-dz-message>
              <div class="upload-icon">
                <i class="ri-upload-cloud-line"></i>
              </div>
              <h4>Drop files here or click to upload</h4>
              <p>Supported: PDF, JPG, PNG (Max 10MB)</p>
            </div>
          </div>

          <!-- Generate Button -->
          <button type="button" class="generate-btn" id="generate-btn" disabled>
            <i class="ri-magic-line"></i>
            <span id="btn-text">Generate Quiz</span>
            <div id="loading-spinner" style="display: none;">
              <i class="ri-loader-4-line"></i> Processing...
            </div>
          </button>
        </div>

        <!-- Processing Status -->
        <div id="processing-status" style="display: none;" class="processing-status">
          <div class="status-content">
            <div class="status-icon">
              <i class="ri-loader-4-line"></i>
            </div>
            <h3>Processing Document via API...</h3>
            <p id="status-message">üåê Connecting to AI service...</p>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <!-- API Log -->
            <div id="api-log" class="api-log">
              <h4>üì° API Activity Log</h4>
              <div id="log-content" class="log-content"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Dropzone JavaScript -->
<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
<script src="{% static 'js/quiz_generator.js' %}"></script>
{% endblock %}
