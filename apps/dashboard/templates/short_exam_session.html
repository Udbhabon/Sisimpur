{% extends 'dashboard_base.html' %}
{% load static %}
{% block title %}Short Answer Exam - {{ exam_session.processing_job.document_name }} - SISIMPUR{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/short_exam_session.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="content-container">
        <div class="exam-container" 
             data-remaining-time="{{ remaining_time }}" 
               data-evaluate-url="{% url 'brain:evaluate_short_answer' %}"
             data-session-id="{{ exam_session.session_id }}"
             data-question-id="{{ current_question.id }}">
            <!-- Exam Header -->
            <div class="exam-header">
                <h1 class="exam-title">{{ exam_session.processing_job.document_name }}</h1>
                <div class="exam-timer">
                    <i class="ri-timer-line"></i>
                    <span id="timer-display">{{ remaining_time|floatformat:0 }}s</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="exam-progress">
                <span class="progress-info">Question {{ current_index|add:1 }} of {{ total_questions }}</span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ progress_percentage }}%"></div>
                </div>
                <span class="progress-info">{{ progress_percentage }}% Complete</span>
            </div>

            <!-- Question Container -->
            <div class="question-container">
                <div class="question-header">
                    <span class="question-number">Question {{ current_index|add:1 }}</span>
                    <span class="question-type">Short Answer</span>
                </div>

                <div class="question-text">
                    {{ current_question.question }}
                </div>

                <form method="post" id="exam-form">
                    {% csrf_token %}
                    <div class="answer-section">
                        <!-- Answer Instructions -->
                        <div class="answer-instructions">
                            <i class="ri-information-line"></i>
                            You can type your answer below or use voice input. Be as detailed and clear as possible.
                        </div>

                        <!-- Voice Input -->
                        <div class="voice-input-container">
                            <button type="button" class="voice-btn" id="voice-btn">
                                <i class="ri-mic-line" id="voice-icon"></i>
                                <span id="voice-text">Start Voice Input</span>
                            </button>
                            <span class="voice-status" id="voice-status">Click to start recording</span>
                        </div>

                        <!-- Answer Input -->
                        <div class="answer-input-container">
                            <textarea 
                                name="answer" 
                                id="answer-textarea" 
                                class="answer-textarea" 
                                placeholder="Type your detailed answer here..."
                                required
                                maxlength="2000"
                            >{% if existing_answer %}{{ existing_answer.user_answer }}{% endif %}</textarea>
                            <div class="character-count">
                                <span id="char-count">0</span>/2000 characters
                            </div>
                        </div>

                        <!-- Evaluation Feedback (shown after submission) -->
                        <div class="evaluation-feedback" id="evaluation-feedback">
                            <div class="feedback-score">
                                <span>Your Score:</span>
                                <span class="score-display" id="feedback-score">-</span>
                            </div>
                            <div class="feedback-text" id="feedback-text">
                                <!-- Feedback will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="navigation-buttons">
                        <button type="submit" name="action" value="previous" class="nav-btn btn-previous"
                                {% if not can_go_back %}disabled{% endif %}>
                            <i class="ri-arrow-left-line"></i>
                            Previous
                        </button>

                        <div style="flex: 1;"></div>

                        {% if is_last_question %}
                            <button type="submit" name="action" value="submit" class="nav-btn btn-submit">
                                <i class="ri-check-line"></i>
                                Submit Exam
                            </button>
                        {% else %}
                            <button type="submit" name="action" value="next" class="nav-btn btn-next" id="next-btn">
                                Next
                                <i class="ri-arrow-right-line"></i>
                            </button>
                        {% endif %}
                    </div>
                </form>
            </div>

            <!-- Warning for time -->
            {% if remaining_time < 300 %}
            <div class="warning-message">
                <i class="ri-alarm-warning-line"></i>
                <span>Warning: Less than 5 minutes remaining!</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/short_exam_session.js' %}"></script>
{% endblock %}

